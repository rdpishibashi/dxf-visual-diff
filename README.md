# DXF Visual Diff Analyzer

複数のDXFファイルペアを比較し、その差分を視覚的に表示するStreamlitアプリケーションです。

## 機能

- **複数ペア比較**: 最大5ペアのDXFファイルを同時に比較
- **高精度比較**: 座標マッチングの許容誤差を設定可能
- **ブロック展開**: INSERT エンティティ（ブロック）を絶対座標に自動展開
- **視覚的差分表示**: 追加・削除・変更なしエンティティを色分けしてレイヤー表示
- **プロフェッショナル出力**: あらゆるCADアプリケーションで開けるDXFファイルを生成

## インストール

### ローカル開発環境

1. このリポジトリをクローンまたはダウンロード
2. 依存関係をインストール:
   ```bash
   pip install -r requirements.txt
   ```
3. アプリケーションを実行:
   ```bash
   streamlit run app.py
   ```

### Streamlit Cloud へのデプロイ

1. このリポジトリをGitHubにプッシュ
2. Streamlit Cloudに接続
3. 以下の設定でデプロイ:
   - **メインファイルパス**: `app.py`
   - **Pythonバージョン**: 3.9以上
   - **要件ファイル**: `requirements.txt`

## 使用方法

### 基本的なワークフロー

1. **ファイルペアの登録**: 最大5ペアのDXFファイルをアップロード
   - 各ペアは「基準DXFファイル (A)」と「比較対象DXFファイル (B)」で構成
   - 識別しやすいようにペアごとに名前を設定可能

2. **オプション設定** (任意):
   - **座標許容誤差**: 座標比較の精度を設定 (デフォルト: 0.01)
   - **レイヤー色**: エンティティタイプごとの色を選択:
     - 削除エンティティ (Aにのみ存在) - デフォルト: マゼンタ
     - 追加エンティティ (Bにのみ存在) - デフォルト: シアン  
     - 変更なしエンティティ (両方に存在) - デフォルト: 白/黒

3. **ファイル処理**: 「DXF差分を比較」ボタンをクリックして比較開始

4. **結果のダウンロード**: 正常に処理された各ペアごとにダウンロードボタンを表示

### 出力ファイル

各比較により生成されるDXFファイル名: `(Aのファイル名)_vs_(Bのファイル名).dxf`

出力ファイルには3つのレイヤーが含まれます:
- **ADDED**: ファイルBにのみ存在するエンティティ
- **DELETED**: ファイルAにのみ存在するエンティティ  
- **UNCHANGED**: 両方のファイルに存在するエンティティ

## 技術詳細

### サポートされているエンティティタイプ

- LINE, CIRCLE, ARC, ELLIPSE
- TEXT, MTEXT, ATTRIB (属性)
- POINT, LWPOLYLINE
- INSERT (ブロック) - 絶対座標に自動展開

### 高度な機能

1. **ブロック展開**: INSERTエンティティは以下を考慮して自動展開:
   - 挿入点変換
   - 回転とスケーリング
   - ネストされたブロック階層

2. **高精度比較**:
   - 50桁精度のDecimal演算を使用
   - エンティティタイプごとのコンテキスト対応許容誤差
   - スマートな座標正規化

3. **エンティティフィンガープリント**:
   - 各エンティティの一意なシグネチャを作成
   - ジオメトリ、位置、テキスト内容、属性を考慮
   - 効率的なハッシュベース比較を実現

## 依存関係

- **streamlit** >= 1.30.0: ウェブアプリケーションフレームワーク
- **ezdxf** >= 1.4.2: DXFファイルの読み書き
- **numpy** >= 1.24.0: 数値計算

## システム要件

- Python 3.9 以上
- 最小 512MB RAM (一般的なDXFファイルの場合)
- JavaScriptが有効な最新のウェブブラウザ

## 制限事項

- セッションあたり最大5ファイルペア
- DXFファイルはezdxfライブラリで読み取り可能である必要があります
- 非常に大きなファイル (>100MB) はクラウドプラットフォームでメモリ問題を引き起こす可能性があります

## トラブルシューティング

### よくある問題

1. **「DXFファイルの読み取りエラー」**:
   - ファイルが有効なDXF形式であることを確認
   - ファイルが破損またはパスワード保護されていないか確認

2. **「メモリエラー」**:
   - ファイルペアの数を減らしてみてください
   - エンティティ数の少ないファイルを使用してください

3. **「処理タイムアウト」**:
   - 大きいまたは複雑なファイルは処理に時間がかかる場合があります
   - 座標許容誤差を増やして処理時間を短縮することを検討してください

### サポート

技術サポートやバグレポートについては、アプリケーションログを確認するか、開発チームにお問い合わせください。

## ライセンス

このアプリケーションは 株式会社RDPi 所有であり特定顧客向けに開発されています。コピーや改版は禁止されています。

## バージョン履歴

- **v1.0.0**: 複数ペアDXF比較機能を備えた初回リリース
  - 最大5ファイルペアのサポート
  - 高精度比較エンジン
  - 色分けされた差分可視化
  - ファイル名の自動生成